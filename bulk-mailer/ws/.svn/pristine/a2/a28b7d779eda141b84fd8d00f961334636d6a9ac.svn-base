package beeriprint.newsletter.camel;

import beeriprint.newsletter.model.StatusUpdate;
import java.util.HashMap;
import java.util.Map;
import org.apache.camel.Exchange;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 *
 * @author hilel
 */
public class QueryBuilder {

    final Logger logger = LoggerFactory.getLogger(getClass());
    //final DateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
    final String updateOpened = "UPDATE email SET opened  = :?requestTime WHERE id = :?messageCode";
    final String updateClicked = "UPDATE email SET clicked = :?requestTime WHERE id = :?messageCode";
    Map updateParameters;

    public void updateOpened(Exchange exchange, StatusUpdate statusUpdate) throws Exception {
        updateParameters = new HashMap();
        updateParameters.put("requestTime", statusUpdate.getRequestTime().getTime());
        updateParameters.put("messageCode", statusUpdate.getMessageCode());
        exchange.getOut().setBody(updateOpened);
        exchange.getOut().setHeader("CamelJdbcParameters", updateParameters);
    }

    public void updateClicked(Exchange exchange, StatusUpdate statusUpdate) throws Exception {
        updateParameters = new HashMap();
        updateParameters.put("requestTime", statusUpdate.getRequestTime().getTime());
        updateParameters.put("messageCode", statusUpdate.getMessageCode());
        exchange.getOut().setBody(updateClicked);
        exchange.getOut().setHeader("CamelJdbcParameters", updateParameters);
    }
}
