package beeriprint.newsletter.ws;

import beeriprint.newsletter.model.StatusUpdate;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import javax.xml.bind.JAXBContext;
import javax.xml.bind.JAXBException;
import javax.xml.bind.Marshaller;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.transform.Transformer;
import javax.xml.transform.TransformerConfigurationException;
import javax.xml.transform.TransformerFactory;

/**
 *
 * @author hilel-deb
 */
public class XmlTranslator {

    DocumentBuilder documentBuilder;
    Transformer transformer;
    DateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");

    public XmlTranslator() throws ParserConfigurationException, TransformerConfigurationException {
        documentBuilder = DocumentBuilderFactory.newInstance().newDocumentBuilder();
        transformer = TransformerFactory.newInstance().newTransformer();
    }

    public String createStatusMessage(String ebillMessageCode, int resourceId)
            throws JAXBException, IOException {

        StatusUpdate statusUpdate = new StatusUpdate();
        statusUpdate.setMessageCode(ebillMessageCode);
        statusUpdate.setResourceId(resourceId);
        statusUpdate.setRequestTime(Calendar.getInstance());

        JAXBContext jaxbContext = JAXBContext.newInstance(StatusUpdate.class);
        Marshaller jaxbMarshaller = jaxbContext.createMarshaller();
        try (OutputStream out = new ByteArrayOutputStream()) {
            jaxbMarshaller.marshal(statusUpdate, out);
            return out.toString();
        }
    }
}
