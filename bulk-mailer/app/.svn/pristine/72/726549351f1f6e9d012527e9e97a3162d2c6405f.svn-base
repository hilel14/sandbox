#!/bin/sh

# Newsletter outbound postfix configuration script

# exit on first error
set -e

# postfix is installed by default
#yum -y install postfix

# enable service and allow access
systemctl enable postfix
firewall-cmd --permanent --add-service smtp

# /etc/postfix/master.cf
cat <<EOF >> /etc/postfix/master.cf
slowdown         unix  -       -       n       -       -       smtp
EOF

# /etc/postfix/main.cf
cat <<EOF >> /etc/postfix/main.cf

mailbox_size_limit = 1024000000
virtual_alias_maps = hash:/etc/postfix/virtual
transport_maps = hash:/etc/postfix/transport

slowdown_destination_rate_delay = 6s
slowdown_destination_concurrency_limit = 1
slowdown_destination_recipient_limit = 2
slowdown_initial_destination_concurrency=1

EOF

# /etc/postfix/virtual
cat <<EOF >> /etc/postfix/virtual
@beeriprint-content.co.il importer
EOF
#
postmap /etc/postfix/virtual 

# /etc/postfix/transport
cat <<EOF >> /etc/postfix/transport
BankLeumi.co.il     slowdown
bezeqint.co.il      slowdown
netvision.net.il    slowdown
EOF
#
postmap /etc/postfix/transport

postfix reload

#################################################

# Manual configuration:
# /etc/postfix/main.cf: inet_interfaces = all
# /etc/aliases: postmaster = importer
# newaliases
